<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adithya's Daily HQ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- ‚úÖ STEP 1: Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#faf7f2;--bg2:#f3ede4;--bg3:#ece5d8;
  --card:#fff;--border:#e8e0d4;--border2:#d4c9b8;
  --text:#1a1612;--muted:#8a7d6e;--muted2:#b8ad9e;
  --accent:#e8612a;--a2:rgba(232,97,42,0.1);--a3:rgba(232,97,42,0.05);
  --green:#2a9e5c;--g2:rgba(42,158,92,0.1);
  --blue:#2a6ee8;--b2:rgba(42,110,232,0.1);
  --yellow:#d4900a;--y2:rgba(212,144,10,0.1);
  --purple:#8a2ae8;--p2:rgba(138,42,232,0.1);
  --red:#e82a2a;--r2:rgba(232,42,42,0.08);
  --teal:#0a9e9e;--t2:rgba(10,158,158,0.1);
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;overflow-x:hidden}
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
.sidebar{background:var(--text);display:flex;flex-direction:column;position:sticky;top:0;height:100vh;overflow-y:auto}
.sb-head{padding:24px 20px 18px;border-bottom:1px solid rgba(255,255,255,0.07)}
.sb-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;color:#fff;display:flex;align-items:center;gap:8px}
.sb-logo em{color:var(--accent);font-style:normal}
.sb-sub{font-size:11px;color:rgba(255,255,255,0.35);margin-top:3px}
.sb-user{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.07)}
.sb-name{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;color:#fff}
.sb-date{font-size:11px;color:rgba(255,255,255,0.35);margin-top:2px}
.sb-prog{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.07)}
.sb-prog-top{display:flex;justify-content:space-between;font-size:11px;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.sb-bar{height:3px;background:rgba(255,255,255,0.08);border-radius:2px}
.sb-fill{height:100%;background:var(--accent);border-radius:2px;transition:width 0.6s ease}
.sb-nav{padding:14px 12px;flex:1}
.sb-sec-label{font-size:9px;color:rgba(255,255,255,0.25);text-transform:uppercase;letter-spacing:2px;padding:0 8px;margin-bottom:6px;margin-top:4px}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:6px;cursor:pointer;transition:background 0.15s;margin-bottom:1px}
.nav-item:hover{background:rgba(255,255,255,0.06)}
.nav-item.active{background:rgba(255,255,255,0.1)}
.nav-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.nav-label{font-size:12px;color:rgba(255,255,255,0.6);flex:1;line-height:1.3}
.nav-item.active .nav-label{color:#fff;font-weight:500}
.nav-count{font-family:'Syne',sans-serif;font-weight:700;font-size:10px;color:rgba(255,255,255,0.25)}
.sb-btn{margin:12px;padding:10px;background:rgba(232,97,42,0.12);border:1px solid rgba(232,97,42,0.25);color:var(--accent);font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:background 0.2s;display:flex;align-items:center;justify-content:center;gap:6px;width:calc(100% - 24px)}
.sb-btn:hover{background:rgba(232,97,42,0.22)}
.sb-btn.on{background:rgba(42,158,92,0.12);border-color:rgba(42,158,92,0.25);color:var(--green)}
.main{display:flex;flex-direction:column;overflow:hidden}
.tabs{display:flex;border-bottom:1px solid var(--border);background:var(--card);position:sticky;top:0;z-index:50}
.tab{padding:14px 24px;font-family:'Syne',sans-serif;font-weight:700;font-size:12px;letter-spacing:0.5px;cursor:pointer;color:var(--muted);border-bottom:2px solid transparent;transition:all 0.2s;text-transform:uppercase}
.tab:hover{color:var(--text)}
.tab.active{color:var(--accent);border-color:var(--accent)}
.pane{display:none;padding:28px 32px;overflow-y:auto;flex:1}
.pane.active{display:block}
.top-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
.page-h{font-family:'Syne',sans-serif;font-weight:800;font-size:24px;letter-spacing:-1px}
.page-h span{color:var(--accent)}
.add-btn{background:var(--accent);color:#fff;border:none;font-family:'Syne',sans-serif;font-weight:700;font-size:12px;padding:10px 18px;cursor:pointer;display:flex;align-items:center;gap:6px;transition:transform 0.2s,box-shadow 0.2s}
.add-btn:hover{transform:translate(-2px,-2px);box-shadow:4px 4px 0 rgba(232,97,42,0.2)}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:24px}
.stat-box{background:var(--card);border:1px solid var(--border);padding:14px 16px;transition:border-color 0.2s}
.stat-box:hover{border-color:var(--accent)}
.stat-n{font-family:'Syne',sans-serif;font-weight:800;font-size:26px;letter-spacing:-1px;line-height:1;margin-bottom:3px}
.stat-l{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
.task-section{margin-bottom:20px}
.ts-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.ts-title{font-family:'Syne',sans-serif;font-weight:700;font-size:13px;display:flex;align-items:center;gap:8px}
.ts-badge{font-size:10px;font-family:'Syne',sans-serif;font-weight:700;padding:2px 8px;letter-spacing:0.5px}
.task-list{display:flex;flex-direction:column;gap:4px}
.task-card{background:var(--card);border:1px solid var(--border);padding:12px 14px;display:flex;align-items:flex-start;gap:10px;transition:border-color 0.15s,box-shadow 0.15s;cursor:pointer;position:relative}
.task-card:hover{border-color:var(--border2);box-shadow:0 2px 8px rgba(0,0,0,0.06)}
.task-card.done{opacity:0.45}
.task-card.done .tc-text{text-decoration:line-through;color:var(--muted)}
.tc-check{width:18px;height:18px;border:2px solid var(--border2);border-radius:3px;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all 0.2s;margin-top:1px;cursor:pointer;flex-shrink:0}
.tc-check:hover{border-color:var(--green)}
.tc-check.checked{background:var(--green);border-color:var(--green)}
.tc-check.checked::after{content:'‚úì';color:#fff;font-size:10px;font-weight:700}
.tc-body{flex:1;min-width:0}
.tc-text{font-size:13px;line-height:1.4;margin-bottom:5px}
.tc-meta{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.tc-cat{font-size:9px;font-family:'Syne',sans-serif;font-weight:700;letter-spacing:1px;padding:2px 6px;text-transform:uppercase}
.tc-pri{font-size:9px;font-family:'Syne',sans-serif;font-weight:700;padding:2px 6px}
.tc-time{font-size:10px;color:var(--muted);display:flex;align-items:center;gap:3px}
.tc-timer{font-size:10px;font-family:'Syne',sans-serif;font-weight:700;color:var(--accent);padding:2px 8px;border:1px solid rgba(232,97,42,0.2);background:var(--a3)}
.tc-right{display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0}
.tc-actions{display:flex;gap:3px;opacity:0;transition:opacity 0.15s}
.task-card:hover .tc-actions{opacity:1}
.tc-btn{background:none;border:1px solid var(--border);padding:3px 7px;font-size:10px;cursor:pointer;color:var(--muted);transition:all 0.15s}
.tc-btn:hover{border-color:var(--accent);color:var(--accent)}
.tc-btn.del:hover{border-color:var(--red);color:var(--red)}
.cal-wrap{background:var(--card);border:1px solid var(--border);margin-bottom:24px}
.cal-head{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border)}
.cal-month{font-family:'Syne',sans-serif;font-weight:800;font-size:16px;letter-spacing:-0.5px}
.cal-nav{display:flex;gap:8px}
.cal-nav-btn{background:none;border:1px solid var(--border);width:28px;height:28px;cursor:pointer;font-size:13px;color:var(--muted);transition:all 0.15s;display:flex;align-items:center;justify-content:center}
.cal-nav-btn:hover{border-color:var(--accent);color:var(--accent)}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr)}
.cal-day-head{padding:8px 4px;text-align:center;font-family:'Syne',sans-serif;font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--muted);border-bottom:1px solid var(--border)}
.cal-day{padding:8px 6px;min-height:64px;border-right:1px solid var(--border);border-bottom:1px solid var(--border);cursor:pointer;transition:background 0.15s;position:relative}
.cal-day:nth-child(7n){border-right:none}
.cal-day:hover{background:var(--bg2)}
.cal-day.today{background:var(--a3)}
.cal-day.selected{background:rgba(232,97,42,0.08);border-color:rgba(232,97,42,0.3)}
.cal-day.other-month{opacity:0.3}
.cal-day-num{font-family:'Syne',sans-serif;font-weight:700;font-size:12px;margin-bottom:4px}
.cal-day.today .cal-day-num{color:var(--accent)}
.cal-dot-row{display:flex;gap:2px;flex-wrap:wrap}
.cal-dot{width:5px;height:5px;border-radius:50%}
.cal-sel-tasks{border-top:1px solid var(--border);padding:16px 20px}
.cal-sel-label{font-family:'Syne',sans-serif;font-weight:700;font-size:13px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between}
.cal-add-day{background:none;border:1px solid var(--border);padding:4px 10px;font-size:11px;cursor:pointer;color:var(--muted);font-family:'DM Sans',sans-serif;transition:all 0.15s}
.cal-add-day:hover{border-color:var(--accent);color:var(--accent)}
.notes-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
.note-card{background:var(--card);border:1px solid var(--border);padding:16px}
.note-label{font-family:'Syne',sans-serif;font-weight:700;font-size:11px;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}
.note-ta{width:100%;min-height:100px;border:none;outline:none;resize:vertical;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text);background:transparent;line-height:1.6}
.note-ta::placeholder{color:var(--muted2)}
.save-note-btn{background:var(--text);color:#fff;border:none;font-family:'Syne',sans-serif;font-weight:700;font-size:11px;padding:7px 14px;cursor:pointer;margin-top:10px;transition:background 0.2s}
.save-note-btn:hover{background:var(--accent)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:1000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(3px);padding:20px}
.overlay.open{display:flex}
.modal{background:var(--card);width:100%;max-width:520px;max-height:90vh;overflow-y:auto;position:relative;animation:modalIn 0.2s ease}
@keyframes modalIn{from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-head{padding:24px 24px 0;display:flex;align-items:center;justify-content:space-between}
.modal-title{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;letter-spacing:-0.5px}
.modal-x{background:none;border:1px solid var(--border);width:30px;height:30px;cursor:pointer;font-size:14px;color:var(--muted);transition:all 0.15s;display:flex;align-items:center;justify-content:center}
.modal-x:hover{border-color:var(--red);color:var(--red)}
.modal-body{padding:20px 24px 24px}
.fg{margin-bottom:14px}
.fl{font-size:10px;font-family:'Syne',sans-serif;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;display:block}
.fi{width:100%;border:1px solid var(--border);padding:9px 12px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text);background:var(--bg);outline:none;transition:border-color 0.15s}
.fi:focus{border-color:var(--accent)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.sub-btn{background:var(--accent);color:#fff;border:none;font-family:'Syne',sans-serif;font-weight:700;font-size:13px;padding:12px;cursor:pointer;width:100%;transition:opacity 0.2s}
.sub-btn:hover{opacity:0.9}
.detail-modal{max-width:560px}
.detail-head{padding:24px;border-bottom:1px solid var(--border)}
.detail-cat-badge{font-size:10px;font-family:'Syne',sans-serif;font-weight:700;letter-spacing:1px;padding:3px 10px;text-transform:uppercase;margin-bottom:12px;display:inline-block}
.detail-title{font-family:'Syne',sans-serif;font-weight:800;font-size:20px;letter-spacing:-0.5px;line-height:1.3;margin-bottom:10px}
.detail-meta{display:flex;gap:8px;flex-wrap:wrap}
.detail-body{padding:20px 24px}
.detail-section-label{font-family:'Syne',sans-serif;font-weight:700;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;margin-top:16px}
.detail-section-label:first-child{margin-top:0}
.detail-timer{padding:16px;border:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;background:var(--bg2)}
.detail-timer-display{font-family:'Syne',sans-serif;font-weight:800;font-size:32px;letter-spacing:-2px;color:var(--accent)}
.detail-timer-btns{display:flex;gap:8px}
.dt-btn{border:none;padding:8px 16px;font-family:'Syne',sans-serif;font-weight:700;font-size:12px;cursor:pointer;transition:opacity 0.2s}
.dt-start{background:var(--green);color:#fff}
.dt-pause{background:var(--yellow);color:#fff}
.dt-reset{background:var(--border2);color:var(--muted)}
.dt-btn:hover{opacity:0.8}
.subtask-list{list-style:none}
.subtask-item{display:flex;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px;align-items:flex-start}
.subtask-item:last-child{border-bottom:none}
.subtask-check{width:16px;height:16px;border:2px solid var(--border2);border-radius:3px;flex-shrink:0;cursor:pointer;margin-top:1px;display:flex;align-items:center;justify-content:center;transition:all 0.15s}
.subtask-check:hover{border-color:var(--green)}
.subtask-check.done{background:var(--green);border-color:var(--green)}
.subtask-check.done::after{content:'‚úì';font-size:9px;color:#fff;font-weight:700}
.subtask-text{flex:1;color:var(--muted);line-height:1.4}
.subtask-text.done-text{text-decoration:line-through;color:var(--muted2)}
.detail-notes-ta{width:100%;min-height:80px;border:1px solid var(--border);padding:10px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text);background:var(--bg);outline:none;resize:vertical}
.detail-notes-ta:focus{border-color:var(--accent)}
.detail-footer{padding:0 24px 24px;display:flex;gap:8px}
.df-btn{flex:1;padding:10px;font-family:'Syne',sans-serif;font-weight:700;font-size:12px;cursor:pointer;border:none;transition:opacity 0.2s}
.df-btn:hover{opacity:0.85}
.toast{position:fixed;bottom:20px;right:20px;background:var(--text);color:#fff;padding:10px 18px;font-size:12px;z-index:3000;transform:translateY(60px);opacity:0;transition:all 0.3s;pointer-events:none}
.toast.show{transform:translateY(0);opacity:1}
/* Loading overlay */
.loading-screen{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;gap:12px}
.loading-screen.hidden{display:none}
.loading-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:28px;color:var(--text)}
.loading-logo em{color:var(--accent);font-style:normal}
.loading-bar-wrap{width:200px;height:3px;background:var(--border);border-radius:2px;overflow:hidden}
.loading-bar{height:100%;background:var(--accent);border-radius:2px;animation:loadBar 1.5s ease-in-out infinite}
@keyframes loadBar{0%{width:0%;margin-left:0}50%{width:60%;margin-left:20%}100%{width:0%;margin-left:100%}}
.loading-text{font-size:12px;color:var(--muted)}
.c-eject{background:var(--a3);color:var(--accent)}
.c-ejkl{background:var(--b2);color:var(--blue)}
.c-getmama{background:var(--y2);color:var(--yellow)}
.c-crossea{background:var(--p2);color:var(--purple)}
.c-personal{background:var(--g2);color:var(--green)}
.c-infra{background:var(--t2);color:var(--teal)}
.p-high{background:var(--r2);color:var(--red)}
.p-med{background:var(--y2);color:var(--yellow)}
.p-low{background:var(--g2);color:var(--green)}
.empty{padding:24px;text-align:center;color:var(--muted);font-size:13px;border:1px dashed var(--border)}
.empty span{font-size:24px;display:block;margin-bottom:6px}
@media(max-width:800px){
  .app{grid-template-columns:1fr}
  .sidebar{position:relative;height:auto}
  .stats-row{grid-template-columns:repeat(2,1fr)}
  .notes-grid{grid-template-columns:1fr}
  .frow{grid-template-columns:1fr}
  .pane{padding:16px}
}
</style>
</head>
<body>

<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
  <div class="loading-logo">Daily <em>HQ</em> ü¶Å</div>
  <div class="loading-bar-wrap"><div class="loading-bar"></div></div>
  <div class="loading-text">Connecting to database...</div>
</div>

<div class="app">
<!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
<div class="sidebar">
  <div class="sb-head">
    <div class="sb-logo">Daily <em>HQ</em> ü¶Å</div>
    <div class="sb-sub">adithyareddy.online</div>
  </div>
  <div class="sb-user">
    <div class="sb-name">Adithya Reddy üëã</div>
    <div class="sb-date" id="sbDate"></div>
  </div>
  <div class="sb-prog">
    <div class="sb-prog-top"><span>Today</span><span id="sbPct">0%</span></div>
    <div class="sb-bar"><div class="sb-fill" id="sbFill" style="width:0%"></div></div>
  </div>
  <div class="sb-nav">
    <div class="sb-sec-label">Views</div>
    <div class="nav-item active" onclick="setFilter('all')">
      <div class="nav-dot" style="background:#aaa"></div>
      <div class="nav-label">All Tasks</div>
      <div class="nav-count" id="nc-all">0</div>
    </div>
    <div class="sb-sec-label" style="margin-top:10px">Companies</div>
    <div class="nav-item" onclick="setFilter('eject')">
      <div class="nav-dot" style="background:var(--accent)"></div>
      <div class="nav-label">Eject Solutions</div>
      <div class="nav-count" id="nc-eject">0</div>
    </div>
    <div class="nav-item" onclick="setFilter('ejkl')">
      <div class="nav-dot" style="background:var(--blue)"></div>
      <div class="nav-label">EJ √ó KL Radio</div>
      <div class="nav-count" id="nc-ejkl">0</div>
    </div>
    <div class="nav-item" onclick="setFilter('getmama')">
      <div class="nav-dot" style="background:var(--yellow)"></div>
      <div class="nav-label">GetMama</div>
      <div class="nav-count" id="nc-getmama">0</div>
    </div>
    <div class="nav-item" onclick="setFilter('crossea')">
      <div class="nav-dot" style="background:var(--purple)"></div>
      <div class="nav-label">Crossea</div>
      <div class="nav-count" id="nc-crossea">0</div>
    </div>
    <div class="nav-item" onclick="setFilter('infra')">
      <div class="nav-dot" style="background:var(--teal)"></div>
      <div class="nav-label">Infrastructure</div>
      <div class="nav-count" id="nc-infra">0</div>
    </div>
    <div class="nav-item" onclick="setFilter('personal')">
      <div class="nav-dot" style="background:var(--green)"></div>
      <div class="nav-label">Personal</div>
      <div class="nav-count" id="nc-personal">0</div>
    </div>
  </div>
  <button class="sb-btn" id="notifBtn" onclick="toggleNotif()">üîî Enable Reminders</button>
</div>

<!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
<div class="main">
  <div class="tabs">
    <div class="tab active" onclick="switchTab('tasks')">üìã Tasks</div>
    <div class="tab" onclick="switchTab('calendar')">üìÖ Calendar</div>
    <div class="tab" onclick="switchTab('notes')">üìù Notes</div>
  </div>

  <div class="pane active" id="pane-tasks">
    <div class="top-row">
      <div class="page-h">Today's <span>Plan</span></div>
      <button class="add-btn" onclick="openAdd()">+ Add Task</button>
    </div>
    <div class="stats-row">
      <div class="stat-box"><div class="stat-n" id="s-total">0</div><div class="stat-l">Total</div></div>
      <div class="stat-box"><div class="stat-n" id="s-done" style="color:var(--green)">0</div><div class="stat-l">Done</div></div>
      <div class="stat-box"><div class="stat-n" id="s-pending" style="color:var(--accent)">0</div><div class="stat-l">Pending</div></div>
      <div class="stat-box"><div class="stat-n" id="s-high" style="color:var(--red)">0</div><div class="stat-l">High Pri</div></div>
    </div>
    <div class="task-section">
      <div class="ts-header">
        <div class="ts-title">üî• Today<span class="ts-badge" style="background:var(--r2);color:var(--red)" id="b-today">0</span></div>
      </div>
      <div class="task-list" id="list-today"></div>
    </div>
    <div class="task-section">
      <div class="ts-header">
        <div class="ts-title">üìÖ Upcoming<span class="ts-badge" style="background:var(--b2);color:var(--blue)" id="b-upcoming">0</span></div>
      </div>
      <div class="task-list" id="list-upcoming"></div>
    </div>
    <div class="task-section">
      <div class="ts-header">
        <div class="ts-title">‚úÖ Completed<span class="ts-badge" style="background:var(--g2);color:var(--green)" id="b-done">0</span></div>
      </div>
      <div class="task-list" id="list-done"></div>
    </div>
  </div>

  <div class="pane" id="pane-calendar">
    <div class="top-row">
      <div class="page-h">üìÖ <span>Calendar</span></div>
      <button class="add-btn" onclick="openAdd()">+ Add Task</button>
    </div>
    <div class="cal-wrap">
      <div class="cal-head">
        <div class="cal-month" id="calMonth"></div>
        <div class="cal-nav">
          <button class="cal-nav-btn" onclick="calNav(-1)">‚Äπ</button>
          <button class="cal-nav-btn" onclick="calNav(1)">‚Ä∫</button>
        </div>
      </div>
      <div class="cal-grid" id="calGrid"></div>
      <div class="cal-sel-tasks">
        <div class="cal-sel-label">
          <span id="calSelLabel">Click a date to see tasks</span>
          <button class="cal-add-day" onclick="openAddForDate()">+ Add for this day</button>
        </div>
        <div class="task-list" id="calDayTasks"></div>
      </div>
    </div>
  </div>

  <div class="pane" id="pane-notes">
    <div class="top-row">
      <div class="page-h">üìù <span>Notes</span></div>
    </div>
    <div class="notes-grid" id="notes-grid"></div>
    <div style="margin-top:16px">
      <button class="add-btn" onclick="addNoteCard()">+ New Note</button>
    </div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê ADD/EDIT MODAL ‚ïê‚ïê -->
<div class="overlay" id="addModal" onclick="overlayClick(event,'addModal')">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="addTitle">Add Task</div>
      <button class="modal-x" onclick="closeModal('addModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="editId">
      <div class="fg">
        <label class="fl">Task *</label>
        <input class="fi" type="text" id="fText" placeholder="What needs to be done?">
      </div>
      <div class="fg">
        <label class="fl">Details / Subtasks (one per line)</label>
        <textarea class="fi" id="fDetails" rows="3" placeholder="Break it down..." style="resize:vertical"></textarea>
      </div>
      <div class="frow">
        <div class="fg">
          <label class="fl">Category</label>
          <select class="fi" id="fCat">
            <option value="eject">Eject Solutions</option>
            <option value="ejkl">EJ √ó KL Radio</option>
            <option value="getmama">GetMama</option>
            <option value="crossea">Crossea</option>
            <option value="infra">Infrastructure</option>
            <option value="personal">Personal</option>
          </select>
        </div>
        <div class="fg">
          <label class="fl">Priority</label>
          <select class="fi" id="fPri">
            <option value="high">üî¥ High</option>
            <option value="med" selected>üü° Medium</option>
            <option value="low">üü¢ Low</option>
          </select>
        </div>
      </div>
      <div class="frow">
        <div class="fg">
          <label class="fl">Date</label>
          <input class="fi" type="date" id="fDate">
        </div>
        <div class="fg">
          <label class="fl">Reminder Time</label>
          <input class="fi" type="time" id="fTime">
        </div>
      </div>
      <div class="fg">
        <label class="fl">Estimated Duration (mins)</label>
        <input class="fi" type="number" id="fDur" placeholder="e.g. 30" min="1" max="480">
      </div>
      <button class="sub-btn" onclick="saveTask()">Save Task ‚Üí</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê DETAIL MODAL ‚ïê‚ïê -->
<div class="overlay" id="detailModal" onclick="overlayClick(event,'detailModal')">
  <div class="modal detail-modal">
    <div class="detail-head">
      <div class="detail-cat-badge" id="d-cat"></div>
      <div style="display:flex;align-items:start;justify-content:space-between;gap:12px">
        <div class="detail-title" id="d-title"></div>
        <button class="modal-x" onclick="closeModal('detailModal')" style="flex-shrink:0;margin-top:4px">‚úï</button>
      </div>
      <div class="detail-meta" id="d-meta"></div>
    </div>
    <div class="detail-body">
      <div class="detail-section-label">‚è± Task Timer</div>
      <div class="detail-timer">
        <div class="detail-timer-display" id="d-timer-display">00:00:00</div>
        <div class="detail-timer-btns">
          <button class="dt-btn dt-start" id="d-timer-start" onclick="timerToggle()">‚ñ∂ Start</button>
          <button class="dt-btn dt-reset" onclick="timerReset()">‚Ü∫ Reset</button>
        </div>
      </div>
      <div id="d-est" style="font-size:11px;color:var(--muted);margin-top:4px"></div>
      <div id="d-subtasks-wrap" style="display:none">
        <div class="detail-section-label">üìã Subtasks</div>
        <ul class="subtask-list" id="d-subtasks"></ul>
      </div>
      <div class="detail-section-label">üìù Notes for this task</div>
      <textarea class="detail-notes-ta" id="d-notes" placeholder="Add notes, links, context..."></textarea>
    </div>
    <div class="detail-footer">
      <button class="df-btn" style="background:var(--green);color:#fff" onclick="detailCheck()">‚úì Mark Complete</button>
      <button class="df-btn" style="background:var(--bg3);color:var(--text)" onclick="detailEdit()">‚úè Edit</button>
      <button class="df-btn" style="background:var(--r2);color:var(--red)" onclick="detailDelete()">üóë Delete</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚úÖ STEP 2: Supabase Init
// Replace these with YOUR values from:
// Supabase Dashboard ‚Üí Project Settings ‚Üí API
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPABASE_URL = 'https://hghvkvxioqiqvejmwwma.supabase.co'  // ‚Üê paste your project URL
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhnaHZrdnhpb3FpcXZlam13d21hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5OTQ1MzEsImV4cCI6MjA4NzU3MDUzMX0.yAEn13wzqj4ekXwOm5OtjezWQzpWCiOb0zRWrsAsmTw'            // ‚Üê paste your anon key (eyJ...)

const { createClient } = supabase
const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

// ‚ïê‚ïê STATE ‚ïê‚ïê
let tasks=[], notesData={}, notifOn=false, activeFilter='all';
let calYear=new Date().getFullYear(), calMonth=new Date().getMonth();
let calSelDate=new Date().toISOString().split('T')[0];
let detailId=null, timerInterval=null, timerSec=0, timerRunning=false;
let editingId=null;

const TODAY=new Date().toISOString().split('T')[0];

const CATS={
  eject:{label:'Eject Solutions',color:'var(--accent)',cls:'c-eject'},
  ejkl:{label:'EJ √ó KL Radio',color:'var(--blue)',cls:'c-ejkl'},
  getmama:{label:'GetMama',color:'var(--yellow)',cls:'c-getmama'},
  crossea:{label:'Crossea',color:'var(--purple)',cls:'c-crossea'},
  infra:{label:'Infrastructure',color:'var(--teal)',cls:'c-infra'},
  personal:{label:'Personal',color:'var(--green)',cls:'c-personal'},
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚úÖ STEP 3: Supabase helpers
// Maps JS object ‚Üî DB row format
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// JS task object ‚Üí Supabase row
function taskToRow(t) {
  return {
    id: t.id,
    text: t.text || '',
    details: t.details || '',
    cat: t.cat || 'personal',
    pri: t.pri || 'med',
    date: t.date || '',
    time: t.time || '',
    dur: t.dur || 0,
    done: t.done || false,
    subtasks: t.subtasks || [],
    task_notes: t.taskNotes || '',   // DB uses snake_case
    elapsed: t.elapsed || 0,
    created: t.created || new Date().toISOString()
  }
}

// Supabase row ‚Üí JS task object
function rowToTask(r) {
  return {
    ...r,
    taskNotes: r.task_notes || '',   // JS uses camelCase
    subtasks: r.subtasks || [],
    elapsed: r.elapsed || 0,
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚úÖ STEP 4: Load from Supabase
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function load() {
  try {
    // Load tasks
    const { data: taskData, error: taskErr } = await db
      .from('tasks')
      .select('*')
      .order('created', { ascending: true })

    if (taskErr) throw taskErr
    tasks = (taskData || []).map(rowToTask)

    // Load notes
    const { data: noteData } = await db
      .from('notes')
      .select('*')
      .eq('id', 1)
      .single()

    notesData = noteData ? (noteData.data || {}) : {}

  } catch(e) {
    console.error('Supabase load error:', e)
    tasks = []
    notesData = {}
  }

  // First ever load ‚Äî seed default tasks
  if (!tasks.length) await seed()

  document.getElementById('loadingScreen').classList.add('hidden')
  renderAll()
  renderNotes()
  renderCal()
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚úÖ STEP 5: Save tasks to Supabase (upsert)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function saveTasks() {
  if (!tasks.length) return
  try {
    const { error } = await db
      .from('tasks')
      .upsert(tasks.map(taskToRow), { onConflict: 'id' })
    if (error) throw error
  } catch(e) {
    console.error('saveTasks error:', e)
    showToast('‚ö†Ô∏è Save failed')
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚úÖ STEP 6: Save notes to Supabase (upsert)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function saveNotes() {
  try {
    const { error } = await db
      .from('notes')
      .upsert({ id: 1, data: notesData })
    if (error) throw error
  } catch(e) {
    console.error('saveNotes error:', e)
  }
}

// ‚ïê‚ïê SEED (first time only ‚Äî inserts defaults) ‚ïê‚ïê
async function seed() {
  const def=[
    {text:'Deploy ejectsolutions.com ‚Äî new website live',cat:'infra',pri:'high',date:TODAY,time:'18:00',dur:60,details:'Upload final build\nUpdate DNS records\nTest all links\nPost on social media after'},
    {text:'Upload hirebotsai.online ‚Äî update WhatsApp number',cat:'infra',pri:'high',date:TODAY,time:'17:00',dur:30,details:'Replace 919999999999 with actual number\nTest all WhatsApp click links\nVerify pricing section shows correctly'},
    {text:'Activate TrueConnex n8n daily automation schedule',cat:'infra',pri:'med',date:TODAY,time:'',dur:20,details:'Toggle active in n8n\nVerify 8AM IST cron trigger\nTest run once manually'},
    {text:'Create social media content ‚Äî 3 day batch for Eject Solutions',cat:'eject',pri:'high',date:TODAY,time:'',dur:45,details:'Post 1: Internship applications open\nPost 2: What is Agentic AI\nPost 3: Behind the scenes of Eject\nAdd hashtags and tag relevant pages'},
    {text:'Plan collabs with influencers and pages for internship',cat:'eject',pri:'med',date:TODAY,time:'',dur:30,details:'List 5 tech influencers in AP/TS\nDM template for collaboration ask\nMeme page options: Hyderabad student pages\nBudget: organic first'},
    {text:'Filter 35 form responses ‚Äî shortlist Batch 1',cat:'eject',pri:'high',date:TODAY,time:'',dur:30,details:'Filter getinternships.ejectsolutions.com responses\nFilter klradio.ejectsolutions.com responses\nCriteria: interest level, availability\nTarget: 15-20 confirmed'},
    {text:'Draft Batch 1 screening mail',cat:'ejkl',pri:'high',date:TODAY,time:'',dur:45,details:"Subject line: You're selected for screening\nBody: Project options overview\nLink: klscreening.ejectsolutions.com\nCTA: Fill form by [date]"},
    {text:'Deploy klscreening.ejectsolutions.com website',cat:'ejkl',pri:'high',date:TODAY,time:'',dur:60,details:'Create screening landing page\nProject selection UI\nSubscription info section\nTimeline per project\nSubmit/confirm button'},
    {text:'Finalise and document all Batch 1 projects',cat:'ejkl',pri:'high',date:TODAY,time:'',dur:60,details:'Project 1: Social Media Automation Bot\nProject 2: Invoice Generator Bot\nProject 3: Blog Content Engine\nProject 4: Ads Intelligence Bot\nProject 5: TrueConnex Automation\nProject 6: KL Radio Content Bot'},
    {text:'Design sample student portal UI',cat:'ejkl',pri:'med',date:TODAY,time:'',dur:90,details:'Show project selection screen\nShow timeline view per project\nProgress tracker UI\nCertificate preview at end\nMobile-friendly design'},
    {text:'Revise and finalise KLU pitch doc',cat:'ejkl',pri:'high',date:TODAY,time:'',dur:45,details:'Update 35 responses stat\nAdd faculty meet section\nAdd batch flow diagram\nUpdate timeline to March dates'},
    {text:'WhatsApp Shivakumar ‚Äî confirm Vijayawada trip date',cat:'ejkl',pri:'high',date:TODAY,time:'15:00',dur:5,details:'Ask him to set up Sridhar and Srinath meetings same day\nTarget date: Mar 3-5'},
    {text:'Deploy socialgetmama.vercel.app automation bot',cat:'getmama',pri:'high',date:TODAY,time:'',dur:60,details:'Activate n8n workflow for GetMama\nConnect Meta, Pinterest, WhatsApp, Telegram, X\nTest first automated post\nVerify Google Sheets dashboard syncing'},
    {text:'Create getmama.online landing page',cat:'getmama',pri:'high',date:TODAY,time:'',dur:90,details:'Hero: automation for small businesses\nServices section\nPricing: ‚Çπ3k / ‚Çπ12k\nFB forms integration\nWhatsApp CTA button'},
    {text:'Post GetMama intro content on all platforms',cat:'getmama',pri:'med',date:TODAY,time:'',dur:30,details:'Meta (Instagram + Facebook)\nPinterest board\nWhatsApp business communities\nTelegram groups\nX (Twitter)'},
    {text:'Finalise Crossea website UI',cat:'crossea',pri:'high',date:TODAY,time:'',dur:90,details:'Review current crossea.vercel.app\nDecide: keep or redesign?\nSections needed: hero, services, about, contact\nBrand colors and fonts\nMobile responsive'},
    {text:'Create 3-day social media content batch for Crossea',cat:'crossea',pri:'med',date:TODAY,time:'',dur:30,details:'Post 1: What is Crossea\nPost 2: Import-export made easy\nPost 3: Industry stat + insight\nHashtags: logistics, export, B2B'},
    {text:'Plan influencer collabs for Crossea',cat:'crossea',pri:'low',date:TODAY,time:'',dur:20,details:'Find logistics/export pages on LinkedIn\nIdentify B2B influencers\nDM template for collab ask'},
    {text:'Message ‚Çπ6k person ‚Äî 2-3 day extension request',cat:'personal',pri:'high',date:TODAY,time:'14:00',dur:2,details:'Send on WhatsApp\nDo not over-explain'},
    {text:'Send Message 2 to Joseph anna ‚Äî show KL Radio work',cat:'personal',pri:'high',date:TODAY,time:'16:00',dur:5,details:'Keep casual\nDon\'t mention money yet'},
    {text:'Check on plants üå±',cat:'personal',pri:'low',date:TODAY,time:'',dur:5,details:'Water if needed\nCheck sunlight\nNote any new growth'},
    {text:'Manage all subscriptions ‚Äî list in one place',cat:'personal',pri:'med',date:TODAY,time:'',dur:20,details:'List all active subscriptions\nNote monthly cost of each\nCancel unused ones\nTrack in Google Sheets'},
    {text:'30 mins AMCAT/Elitmus prep',cat:'personal',pri:'med',date:TODAY,time:'',dur:30,details:'Today topic: Data Analysis basics\nDo 10 practice questions\nNote weak areas for tomorrow'},
    {text:'Drink water + eat something üçé',cat:'personal',pri:'low',date:TODAY,time:'13:00',dur:5,details:'Glass of water first\nFruits if available\nBiryani allowed at night üòÑ'},
  ];

  tasks = def.map((t,i) => ({
    ...t,
    id: Date.now()+i,
    done: false,
    subtasks: [],
    taskNotes: '',
    elapsed: 0,
    created: new Date().toISOString()
  }))

  // Insert all default tasks into Supabase
  try {
    const { error } = await db.from('tasks').insert(tasks.map(taskToRow))
    if (error) throw error
  } catch(e) {
    console.error('seed error:', e)
  }
}

// ‚ïê‚ïê RENDER ‚ïê‚ïê
function renderAll(){
  let filtered=activeFilter==='all'?tasks:tasks.filter(t=>t.cat===activeFilter);
  const todayT=filtered.filter(t=>t.date===TODAY&&!t.done).sort(sortFn);
  const upcomingT=filtered.filter(t=>t.date>TODAY&&!t.done).sort(sortFn);
  const doneT=filtered.filter(t=>t.date===TODAY&&t.done);
  renderList('list-today',todayT);
  renderList('list-upcoming',upcomingT);
  renderList('list-done',doneT);
  document.getElementById('b-today').textContent=todayT.length;
  document.getElementById('b-upcoming').textContent=upcomingT.length;
  document.getElementById('b-done').textContent=doneT.length;
  const allToday=tasks.filter(t=>t.date===TODAY);
  const allDone=tasks.filter(t=>t.date===TODAY&&t.done);
  document.getElementById('s-total').textContent=tasks.length;
  document.getElementById('s-done').textContent=allDone.length;
  document.getElementById('s-pending').textContent=tasks.filter(t=>!t.done).length;
  document.getElementById('s-high').textContent=tasks.filter(t=>t.pri==='high'&&!t.done).length;
  const pct=allToday.length?Math.round(allDone.length/allToday.length*100):0;
  document.getElementById('sbFill').style.width=pct+'%';
  document.getElementById('sbPct').textContent=pct+'%';
  Object.keys(CATS).forEach(c=>{
    const el=document.getElementById('nc-'+c);
    if(el)el.textContent=tasks.filter(t=>t.cat===c&&!t.done).length;
  });
  document.getElementById('nc-all').textContent=tasks.filter(t=>!t.done).length;
  document.querySelectorAll('.nav-item').forEach(el=>{
    el.classList.remove('active');
    const fn=el.getAttribute('onclick')||'';
    if(fn.includes("'"+activeFilter+"'"))el.classList.add('active');
  });
}

function sortFn(a,b){const p={high:0,med:1,low:2};return(p[a.pri]||1)-(p[b.pri]||1)}

function renderList(id,list){
  const el=document.getElementById(id);
  if(!list.length){
    el.innerHTML=`<div class="empty"><span>‚ú®</span>${id==='list-done'?'Nothing completed yet':'All clear!'}</div>`;
    return;
  }
  el.innerHTML=list.map(t=>taskHTML(t)).join('');
}

function taskHTML(t){
  const cat=CATS[t.cat]||{label:t.cat,cls:'c-eject'};
  const pLabel=t.pri==='high'?'High':t.pri==='med'?'Med':'Low';
  const elapsed=t.elapsed||0;
  const elStr=elapsed>0?fmtTime(elapsed):'';
  return `<div class="task-card ${t.done?'done':''}" onclick="openDetail(${t.id})">
    <div class="tc-check ${t.done?'checked':''}" onclick="event.stopPropagation();toggleDone(${t.id})"></div>
    <div class="tc-body">
      <div class="tc-text">${t.text}</div>
      <div class="tc-meta">
        <span class="tc-cat ${cat.cls}">${cat.label}</span>
        <span class="tc-pri p-${t.pri}">${pLabel}</span>
        ${t.time?`<span class="tc-time">üïê ${t.time}</span>`:''}
        ${t.dur?`<span class="tc-time">‚è± ${t.dur}m</span>`:''}
        ${elStr?`<span class="tc-timer">üü¢ ${elStr}</span>`:''}
      </div>
    </div>
    <div class="tc-right">
      <div class="tc-actions" onclick="event.stopPropagation()">
        <button class="tc-btn" onclick="openEdit(${t.id})">‚úèÔ∏è</button>
        <button class="tc-btn del" onclick="deleteTask(${t.id})">üóëÔ∏è</button>
      </div>
    </div>
  </div>`;
}

// ‚ïê‚ïê CALENDAR ‚ïê‚ïê
function renderCal(){
  const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
  document.getElementById('calMonth').textContent=months[calMonth]+' '+calYear;
  const grid=document.getElementById('calGrid');
  const heads=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  let html=heads.map(d=>`<div class="cal-day-head">${d}</div>`).join('');
  const first=new Date(calYear,calMonth,1).getDay();
  const days=new Date(calYear,calMonth+1,0).getDate();
  const prevDays=new Date(calYear,calMonth,0).getDate();
  for(let i=0;i<first;i++){
    const d=prevDays-first+1+i;
    html+=`<div class="cal-day other-month"><div class="cal-day-num">${d}</div></div>`;
  }
  for(let d=1;d<=days;d++){
    const dateStr=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dayTasks=tasks.filter(t=>t.date===dateStr);
    const isToday=dateStr===TODAY;
    const isSel=dateStr===calSelDate;
    const dots=dayTasks.slice(0,5).map(t=>`<div class="cal-dot" style="background:${(CATS[t.cat]||{color:'#888'}).color}"></div>`).join('');
    html+=`<div class="cal-day${isToday?' today':''}${isSel?' selected':''}" onclick="selectCalDay('${dateStr}')">
      <div class="cal-day-num">${d}</div>
      <div class="cal-dot-row">${dots}</div>
    </div>`;
  }
  grid.innerHTML=html;
  renderCalDay();
}

function selectCalDay(date){calSelDate=date;renderCal()}

function renderCalDay(){
  const opts={weekday:'long',month:'long',day:'numeric'};
  const d=new Date(calSelDate+'T12:00:00');
  document.getElementById('calSelLabel').textContent=d.toLocaleDateString('en-IN',opts);
  const dayTasks=tasks.filter(t=>t.date===calSelDate);
  const el=document.getElementById('calDayTasks');
  if(!dayTasks.length){
    el.innerHTML=`<div class="empty"><span>üì≠</span>No tasks for this day. Add one!</div>`;
    return;
  }
  el.innerHTML=dayTasks.map(t=>taskHTML(t)).join('');
}

function calNav(dir){
  calMonth+=dir;
  if(calMonth>11){calMonth=0;calYear++}
  if(calMonth<0){calMonth=11;calYear--}
  renderCal();
}

function openAddForDate(){openAdd();document.getElementById('fDate').value=calSelDate}

// ‚ïê‚ïê NOTES ‚ïê‚ïê
function renderNotes(){
  const grid=document.getElementById('notes-grid');
  const keys=Object.keys(notesData);
  if(!keys.length){
    grid.innerHTML=`<div class="note-card"><div class="note-label">Quick Note</div><textarea class="note-ta" placeholder="Write anything here ‚Äî ideas, plans, reminders..." onblur="quickSaveNote('default',this.value)"></textarea><button class="save-note-btn" onclick="quickSaveNote('default',document.querySelector('.note-ta').value)">Save</button></div>`;
    return;
  }
  grid.innerHTML=keys.map(k=>`<div class="note-card">
    <div class="note-label">${k} <span style="cursor:pointer;color:var(--red)" onclick="deleteNote('${k}')">‚úï</span></div>
    <textarea class="note-ta" id="note-${k}" onblur="quickSaveNote('${k}',this.value)">${notesData[k]}</textarea>
    <button class="save-note-btn" onclick="quickSaveNote('${k}',document.getElementById('note-${k}').value)">Save</button>
  </div>`).join('');
}

async function quickSaveNote(key,val){
  notesData[key]=val;
  await saveNotes();
  showToast('üìù Saved!');
}

async function deleteNote(key){
  delete notesData[key];
  await saveNotes();
  renderNotes();
}

function addNoteCard(){
  const label=prompt('Note title?');
  if(!label) return;
  notesData[label]='';
  saveNotes();
  renderNotes();
}

// ‚ïê‚ïê TASK ACTIONS ‚ïê‚ïê
async function toggleDone(id){
  const t=tasks.find(t=>t.id===id);
  if(!t) return;
  t.done=!t.done;
  // Only update this one task in Supabase
  await db.from('tasks').update({ done: t.done }).eq('id', id)
  renderAll();
  renderCalDay();
  showToast(t.done?'‚úÖ Done!':'‚Ü©Ô∏è Reopened');
  if(t.done) burst();
}

async function deleteTask(id){
  tasks=tasks.filter(t=>t.id!==id);
  // ‚úÖ Delete from Supabase
  await db.from('tasks').delete().eq('id', id)
  renderAll();
  renderCalDay();
  if(detailId===id) closeModal('detailModal');
  showToast('üóëÔ∏è Deleted');
}

function setFilter(cat){activeFilter=cat;renderAll()}

// ‚ïê‚ïê ADD / EDIT ‚ïê‚ïê
function openAdd(){
  editingId=null;
  document.getElementById('addTitle').textContent='Add Task';
  document.getElementById('fText').value='';
  document.getElementById('fDetails').value='';
  document.getElementById('fCat').value='eject';
  document.getElementById('fPri').value='med';
  document.getElementById('fDate').value=TODAY;
  document.getElementById('fTime').value='';
  document.getElementById('fDur').value='';
  openModal('addModal');
  setTimeout(()=>document.getElementById('fText').focus(),100);
}

function openEdit(id){
  const t=tasks.find(t=>t.id===id);
  if(!t) return;
  editingId=id;
  document.getElementById('addTitle').textContent='Edit Task';
  document.getElementById('fText').value=t.text;
  document.getElementById('fDetails').value=t.details||'';
  document.getElementById('fCat').value=t.cat;
  document.getElementById('fPri').value=t.pri;
  document.getElementById('fDate').value=t.date||'';
  document.getElementById('fTime').value=t.time||'';
  document.getElementById('fDur').value=t.dur||'';
  openModal('addModal');
}

async function saveTask(){
  const text=document.getElementById('fText').value.trim();
  if(!text){showToast('‚ö†Ô∏è Enter task description');return}
  const data={
    text,details:document.getElementById('fDetails').value,
    cat:document.getElementById('fCat').value,
    pri:document.getElementById('fPri').value,
    date:document.getElementById('fDate').value,
    time:document.getElementById('fTime').value,
    dur:parseInt(document.getElementById('fDur').value)||0,
  };
  if(editingId){
    const idx=tasks.findIndex(t=>t.id===editingId);
    if(idx>-1) tasks[idx]={...tasks[idx],...data};
    // ‚úÖ Update only this task in Supabase
    await db.from('tasks').update(taskToRow(tasks[idx])).eq('id', editingId)
    showToast('‚úèÔ∏è Updated!');
  } else {
    const newTask={...data,id:Date.now(),done:false,subtasks:[],taskNotes:'',elapsed:0,created:new Date().toISOString()};
    tasks.push(newTask);
    // ‚úÖ Insert new task in Supabase
    await db.from('tasks').insert([taskToRow(newTask)])
    scheduleReminder(newTask);
    showToast('‚úÖ Task added!');
  }
  renderAll();
  renderCalDay();
  renderCal();
  closeModal('addModal');
  editingId=null;
}

// ‚ïê‚ïê DETAIL MODAL ‚ïê‚ïê
function openDetail(id){
  const t=tasks.find(t=>t.id===id);
  if(!t) return;
  detailId=id;
  timerReset();
  timerSec=t.elapsed||0;
  updateTimerDisplay();
  const cat=CATS[t.cat]||{label:t.cat,cls:'c-eject'};
  document.getElementById('d-cat').textContent=cat.label;
  document.getElementById('d-cat').className='detail-cat-badge '+cat.cls;
  document.getElementById('d-title').textContent=t.text;
  const pLabel=t.pri==='high'?'üî¥ High Priority':t.pri==='med'?'üü° Medium':'üü¢ Low';
  let metaHTML=`<span class="tc-pri p-${t.pri}">${pLabel}</span>`;
  if(t.time)metaHTML+=`<span class="tc-time">üïê ${t.time}</span>`;
  if(t.dur)metaHTML+=`<span class="tc-time">‚è± Est. ${t.dur} min</span>`;
  if(t.date)metaHTML+=`<span class="tc-time">üìÖ ${t.date}</span>`;
  document.getElementById('d-meta').innerHTML=metaHTML;
  document.getElementById('d-est').textContent=t.dur?`Estimated: ${t.dur} minutes`:'';
  const details=t.details||'';
  const lines=details.split('\n').map(l=>l.trim()).filter(l=>l);
  if(lines.length){
    document.getElementById('d-subtasks-wrap').style.display='block';
    if(!t.subtasks||t.subtasks.length!==lines.length){
      t.subtasks=lines.map((l,i)=>({text:l,done:t.subtasks&&t.subtasks[i]?t.subtasks[i].done:false}));
    }
    document.getElementById('d-subtasks').innerHTML=t.subtasks.map((s,i)=>`
      <li class="subtask-item">
        <div class="subtask-check ${s.done?'done':''}" onclick="toggleSubtask(${id},${i})"></div>
        <span class="subtask-text ${s.done?'done-text':''}">${s.text}</span>
      </li>`).join('');
  } else {
    document.getElementById('d-subtasks-wrap').style.display='none';
  }
  document.getElementById('d-notes').value=t.taskNotes||'';
  document.getElementById('d-timer-start').textContent='‚ñ∂ Start';
  document.getElementById('d-timer-start').className='dt-btn dt-start';
  const footerBtn=document.querySelector('.df-btn');
  if(footerBtn)footerBtn.textContent=t.done?'‚Ü© Reopen':'‚úì Mark Complete';
  openModal('detailModal');
}

async function toggleSubtask(tid,idx){
  const t=tasks.find(t=>t.id===tid);
  if(!t||!t.subtasks) return;
  t.subtasks[idx].done=!t.subtasks[idx].done;
  await db.from('tasks').update({ subtasks: t.subtasks }).eq('id', tid)
  openDetail(tid);
}

async function detailCheck(){
  const t=tasks.find(t=>t.id===detailId);
  if(!t) return;
  t.taskNotes=document.getElementById('d-notes').value;
  t.elapsed=timerSec;
  t.done=!t.done;
  await db.from('tasks').update({ done: t.done, task_notes: t.taskNotes, elapsed: t.elapsed }).eq('id', detailId)
  renderAll();
  renderCalDay();
  closeModal('detailModal');
  showToast(t.done?'‚úÖ Completed!':'‚Ü©Ô∏è Reopened');
  if(t.done) burst();
}

function detailEdit(){closeModal('detailModal');setTimeout(()=>openEdit(detailId),100)}
function detailDelete(){const t=tasks.find(t=>t.id===detailId);if(t)t.taskNotes=document.getElementById('d-notes').value;deleteTask(detailId)}

async function saveDetailNotes(){
  const t=tasks.find(t=>t.id===detailId);
  if(t){
    t.taskNotes=document.getElementById('d-notes').value;
    t.elapsed=timerSec;
    await db.from('tasks').update({ task_notes: t.taskNotes, elapsed: t.elapsed }).eq('id', detailId)
  }
}

// ‚ïê‚ïê TIMER ‚ïê‚ïê
function timerToggle(){
  if(timerRunning){
    clearInterval(timerInterval);
    timerRunning=false;
    document.getElementById('d-timer-start').textContent='‚ñ∂ Resume';
    document.getElementById('d-timer-start').className='dt-btn dt-start';
    const t=tasks.find(t=>t.id===detailId);
    if(t){t.elapsed=timerSec; db.from('tasks').update({ elapsed: timerSec }).eq('id', detailId)}
  } else {
    timerRunning=true;
    document.getElementById('d-timer-start').textContent='‚è∏ Pause';
    document.getElementById('d-timer-start').className='dt-btn dt-pause';
    timerInterval=setInterval(()=>{
      timerSec++;
      updateTimerDisplay();
      if(timerSec%30===0){
        const t=tasks.find(t=>t.id===detailId);
        if(t){t.elapsed=timerSec; db.from('tasks').update({ elapsed: timerSec }).eq('id', detailId)}
      }
    },1000);
  }
}

function timerReset(){
  clearInterval(timerInterval);
  timerRunning=false;timerSec=0;
  updateTimerDisplay();
  const startBtn=document.getElementById('d-timer-start');
  if(startBtn){startBtn.textContent='‚ñ∂ Start';startBtn.className='dt-btn dt-start';}
}

function updateTimerDisplay(){document.getElementById('d-timer-display').textContent=fmtTime(timerSec)}
function fmtTime(s){const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`}

// ‚ïê‚ïê MODAL HELPERS ‚ïê‚ïê
function openModal(id){document.getElementById(id).classList.add('open')}
function closeModal(id){
  if(id==='detailModal'){saveDetailNotes();clearInterval(timerInterval);timerRunning=false;}
  document.getElementById(id).classList.remove('open');
}
function overlayClick(e,id){if(e.target===document.getElementById(id))closeModal(id)}

// ‚ïê‚ïê TABS ‚ïê‚ïê
function switchTab(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.pane').forEach(p=>p.classList.remove('active'));
  document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
  document.getElementById('pane-'+tab).classList.add('active');
  if(tab==='calendar')renderCal();
}

// ‚ïê‚ïê NOTIFICATIONS ‚ïê‚ïê
async function toggleNotif(){
  if(notifOn){
    notifOn=false;
    document.getElementById('notifBtn').textContent='üîî Enable Reminders';
    document.getElementById('notifBtn').classList.remove('on');
    showToast('üîï Reminders off');return;
  }
  if(!('Notification' in window)){showToast('‚ö†Ô∏è Not supported');return}
  const p=await Notification.requestPermission();
  if(p==='granted'){
    notifOn=true;
    document.getElementById('notifBtn').textContent='üîî Reminders ON';
    document.getElementById('notifBtn').classList.add('on');
    showToast('üîî Reminders enabled!');
    tasks.forEach(scheduleReminder);
    new Notification('Daily HQ ü¶Å',{body:"You'll be notified for tasks with times set!"});
  } else showToast('‚ö†Ô∏è Permission denied');
}

function scheduleReminder(t){
  if(!notifOn||!t.time||!t.date||t.done) return;
  const tDate=new Date(t.date+'T'+t.time);
  const diff=tDate-new Date();
  if(diff>0&&diff<86400000){
    setTimeout(()=>{if(!tasks.find(x=>x.id===t.id)?.done)new Notification('‚è∞ Task Reminder',{body:t.text,tag:String(t.id)})},diff);
    if(diff>900000)setTimeout(()=>{if(!tasks.find(x=>x.id===t.id)?.done)new Notification('üîî In 15 mins',{body:t.text,tag:String(t.id)+'p'})},diff-900000);
  }
}

// ‚ïê‚ïê TOAST ‚ïê‚ïê
function showToast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),2500);
}

// ‚ïê‚ïê CONFETTI ‚ïê‚ïê
function burst(){
  ['var(--accent)','var(--green)','var(--yellow)','var(--blue)'].forEach((c,i)=>{
    setTimeout(()=>{
      for(let j=0;j<4;j++){
        const d=document.createElement('div');
        const a=Math.random()*360,r=60+Math.random()*80;
        d.style.cssText=`position:fixed;width:7px;height:7px;background:${c};top:50%;left:50%;border-radius:50%;pointer-events:none;z-index:9999;transition:none`;
        document.body.appendChild(d);
        requestAnimationFrame(()=>{
          d.style.transition='all 0.7s ease-out';
          d.style.transform=`translate(${Math.cos(a*(Math.PI/180))*r}px,${Math.sin(a*(Math.PI/180))*r}px)`;
          d.style.opacity='0';
        });
        setTimeout(()=>d.remove(),800);
      }
    },i*60);
  });
}

// ‚ïê‚ïê INIT ‚ïê‚ïê
function initDate(){
  const d=new Date();
  document.getElementById('sbDate').textContent=d.toLocaleDateString('en-IN',{weekday:'long',month:'long',day:'numeric'});
}

document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){closeModal('addModal');closeModal('detailModal')}
  if(e.ctrlKey&&e.key==='n'){e.preventDefault();openAdd()}
});

initDate();
load();  // ‚Üê Loads from Supabase on startup
</script>
</body>
</html>
